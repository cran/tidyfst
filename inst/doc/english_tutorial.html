<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Use data.table the tidy way: An ultimate tutorial of tidyfst</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Use data.table the tidy way: An ultimate tutorial of tidyfst</h1>



<p>I love the tidy syntax of dplyr and the ultimate speed of data.table. Why not take the both? That is why I have started the work of tidyfst, bridging the tidy syntax and computation performance via translation. This tool is especially friendly for dplyr users who want to learn some data.table, but data.table could also benefit from it (more or less).<br><br> A great comparison of data.table and dplyr was displayed at <a href="https://atrebas.github.io/post/2019-03-03-datatable-dplyr/" class="uri">https://atrebas.github.io/post/2019-03-03-datatable-dplyr/</a> (thanks to Atrebas). I love this tutorial very much because it dig rather deep into many features from both packages. Here I’ll try to implement all operations from that tutorial, and the potential users could find why they would prefer tidyfst for some tasks.<br><br> The below examples have all been checked with tidyfst. Now let’s begin.</p>
<div id="create-example-data" class="section level2">
<h2>Create example data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyfst)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">set.seed</span>(1L)</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">## Create a data table</span></a>
<a class="sourceLine" id="cb1-6" title="6">DF &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">V1 =</span> <span class="kw">rep</span>(<span class="kw">c</span>(1L, 2L), <span class="dv">5</span>)[<span class="op">-</span><span class="dv">10</span>],</a>
<a class="sourceLine" id="cb1-7" title="7">                <span class="dt">V2 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>,</a>
<a class="sourceLine" id="cb1-8" title="8">                <span class="dt">V3 =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>),</a>
<a class="sourceLine" id="cb1-9" title="9">                <span class="dt">V4 =</span> <span class="kw">rep</span>(LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">copy</span>(DF) -&gt;<span class="st"> </span>DT</a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">class</span>(DF)</a>
<a class="sourceLine" id="cb1-13" title="13">DF</a></code></pre></div>
</div>
<div id="basic-operations" class="section level1">
<h1>Basic operations</h1>
<div id="filter-rows" class="section level2">
<h2>Filter rows</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">### Filter rows using indices</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">slice_dt</span>(DF, <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">### Discard rows using negative indices</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">slice_dt</span>(DF, <span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">7</span>))</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">### Filter rows using a logical expression</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw">filter_dt</span>(DF, V2 <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw">filter_dt</span>(DF, V4 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>))</a>
<a class="sourceLine" id="cb2-10" title="10"><span class="kw">filter_dt</span>(DF, V4 <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>)) <span class="co"># fast %in% for character</span></a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">### Filter rows using multiple conditions</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="kw">filter_dt</span>(DF, V1 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, V4 <span class="op">==</span><span class="st"> &quot;A&quot;</span>)</a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co"># equals to</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="kw">filter_dt</span>(DF, V1 <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>V4 <span class="op">==</span><span class="st"> &quot;A&quot;</span>)</a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">### Filter unique rows</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="kw">distinct_dt</span>(DF) <span class="co"># unique(DF)</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="kw">distinct_dt</span>(DF, V1,V4)</a>
<a class="sourceLine" id="cb2-20" title="20"></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">### Discard rows with missing values</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="kw">drop_na_dt</span>(DF) <span class="co"># na.omit(DF)</span></a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co">### Other filters</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="kw">sample_n_dt</span>(DF, <span class="dv">3</span>)      <span class="co"># n random rows</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="kw">sample_frac_dt</span>(DF, <span class="fl">0.5</span>) <span class="co"># fraction of random rows</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="kw">top_n_dt</span>(DF, <span class="dv">1</span>, V1)     <span class="co"># top n entries (includes equals)</span></a>
<a class="sourceLine" id="cb2-28" title="28"></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="kw">filter_dt</span>(DT,V4 <span class="op">%like%</span><span class="st"> &quot;^B&quot;</span>)</a>
<a class="sourceLine" id="cb2-30" title="30"><span class="kw">filter_dt</span>(DT,V2 <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb2-31" title="31"><span class="kw">filter_dt</span>(DT,<span class="kw">between</span>(V2, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dt">incbounds =</span> <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb2-32" title="32"><span class="kw">filter_dt</span>(DT,V2 <span class="op">%inrange%</span><span class="st"> </span><span class="kw">list</span>(<span class="op">-</span><span class="dv">1</span><span class="op">:</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>))  <span class="co"># see also ?inrange</span></a></code></pre></div>
</div>
<div id="sort-rows" class="section level2">
<h2>Sort rows</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co">### Sort rows by column</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">arrange_dt</span>(DF, V3)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">### Sort rows in decreasing order</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">arrange_dt</span>(DF, <span class="op">-</span>V3)</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">### Sort rows based on several columns</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="kw">arrange_dt</span>(DF, V1, <span class="op">-</span>V2)</a></code></pre></div>
</div>
<div id="select-columns" class="section level2">
<h2>Select columns</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">### Select one column using an index (not recommended)</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">pull_dt</span>(DT,<span class="dv">3</span>) <span class="co"># returns a vector</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">select_dt</span>(DT,<span class="dv">3</span>) <span class="co"># returns a data.table</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">### Select one column using column name</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">select_dt</span>(DF, V2) <span class="co"># returns a data.table</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">pull_dt</span>(DF, V2)   <span class="co"># returns a vector</span></a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">### Select several columns</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">select_dt</span>(DF, V2, V3, V4)</a>
<a class="sourceLine" id="cb4-11" title="11"><span class="kw">select_dt</span>(DF, V2<span class="op">:</span>V4) <span class="co"># select columns between V2 and V4</span></a>
<a class="sourceLine" id="cb4-12" title="12"></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">### Exclude columns</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="kw">select_dt</span>(DF, <span class="op">-</span>V2, <span class="op">-</span>V3)</a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">### Select/Exclude columns using a character vector</span></a>
<a class="sourceLine" id="cb4-17" title="17">cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;V2&quot;</span>, <span class="st">&quot;V3&quot;</span>)</a>
<a class="sourceLine" id="cb4-18" title="18"><span class="kw">select_dt</span>(DF,<span class="dt">cols =</span> cols)</a>
<a class="sourceLine" id="cb4-19" title="19"><span class="kw">select_dt</span>(DF,<span class="dt">cols =</span> cols,<span class="dt">negate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">### Other selections</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="kw">select_dt</span>(DF, <span class="dt">cols =</span> <span class="kw">paste0</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb4-23" title="23"><span class="kw">relocate_dt</span>(DF, V4) <span class="co"># reorder columns</span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="kw">select_dt</span>(DF, <span class="st">&quot;V&quot;</span>)</a>
<a class="sourceLine" id="cb4-25" title="25"><span class="kw">select_dt</span>(DF, <span class="st">&quot;3$&quot;</span>)</a>
<a class="sourceLine" id="cb4-26" title="26"><span class="kw">select_dt</span>(DF, <span class="st">&quot;.2&quot;</span>)</a>
<a class="sourceLine" id="cb4-27" title="27"><span class="kw">select_dt</span>(DF, <span class="st">&quot;V1|X&quot;</span>)</a>
<a class="sourceLine" id="cb4-28" title="28"><span class="kw">select_dt</span>(DF, <span class="op">-</span><span class="st">&quot;^V2&quot;</span>)</a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co"># remove variables using &quot;-&quot; prior to function</span></a></code></pre></div>
</div>
<div id="summarise-data" class="section level2">
<h2>Summarise data</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">### Summarise one column</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">summarise_dt</span>(DF, <span class="kw">sum</span>(V1)) <span class="co"># returns a data.table</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">summarise_dt</span>(DF, <span class="dt">sumV1 =</span> <span class="kw">sum</span>(V1)) <span class="co"># returns a data.table</span></a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">### Summarise several columns</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="kw">summarise_dt</span>(DF, <span class="kw">sum</span>(V1), <span class="kw">sd</span>(V3))</a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">### Summarise several columns and assign column names</span></a>
<a class="sourceLine" id="cb5-9" title="9">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="st">  </span><span class="kw">summarise_dt</span>(<span class="dt">sumv1 =</span> <span class="kw">sum</span>(V1),</a>
<a class="sourceLine" id="cb5-11" title="11">              <span class="dt">sdv3  =</span> <span class="kw">sd</span>(V3))</a>
<a class="sourceLine" id="cb5-12" title="12"></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">### Summarise a subset of rows</span></a>
<a class="sourceLine" id="cb5-14" title="14">DT[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">sum</span>(V1)]</a>
<a class="sourceLine" id="cb5-15" title="15">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="st">  </span><span class="kw">slice_dt</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="st">  </span><span class="kw">summarise_dt</span>(<span class="kw">sum</span>(V1))</a>
<a class="sourceLine" id="cb5-18" title="18"></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">### Misc</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="kw">summarise_dt</span>(DF, <span class="kw">nth</span>(V3,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-21" title="21"><span class="kw">summarise_dt</span>(DF, <span class="kw">nth</span>(V3,<span class="op">-</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-22" title="22"><span class="kw">summarise_dt</span>(DF, <span class="kw">nth</span>(V3, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb5-23" title="23"><span class="kw">summarise_dt</span>(DF, <span class="kw">uniqueN</span>(V4))</a>
<a class="sourceLine" id="cb5-24" title="24"><span class="kw">uniqueN</span>(DF)</a></code></pre></div>
</div>
<div id="addupdatedelete-columns" class="section level2">
<h2>Add/update/delete columns</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">### Modify a column</span></a>
<a class="sourceLine" id="cb6-2" title="2">DT[, V1 <span class="op">:</span><span class="er">=</span><span class="st"> </span>V1<span class="op">^</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb6-3" title="3">DT</a>
<a class="sourceLine" id="cb6-4" title="4">DF <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">set_mutate</span>(<span class="dt">V1 =</span> V1<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-5" title="5">DF</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">### Add one column</span></a>
<a class="sourceLine" id="cb6-9" title="9">DT[, v5 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">log</span>(V1)][] <span class="co"># adding [] prints the result</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="kw">set_mutate</span>(DF, <span class="dt">v5 =</span> <span class="kw">log</span>(V1))</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">### Add several columns</span></a>
<a class="sourceLine" id="cb6-14" title="14">DT[, <span class="kw">c</span>(<span class="st">&quot;v6&quot;</span>, <span class="st">&quot;v7&quot;</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span>.(<span class="kw">sqrt</span>(V1), <span class="st">&quot;X&quot;</span>)]</a>
<a class="sourceLine" id="cb6-15" title="15">DT[, <span class="st">&#39;:=&#39;</span>(<span class="dt">v6 =</span> <span class="kw">sqrt</span>(V1),</a>
<a class="sourceLine" id="cb6-16" title="16">          <span class="dt">v7 =</span> <span class="st">&quot;X&quot;</span>)]     <span class="co"># same, functional form</span></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="kw">set_mutate</span>(DF, <span class="dt">v6 =</span> <span class="kw">sqrt</span>(V1), <span class="dt">v7 =</span> <span class="st">&quot;X&quot;</span>)</a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">### Create one column and remove the others</span></a>
<a class="sourceLine" id="cb6-23" title="23">DT[, .(<span class="dt">v8 =</span> V3 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)]</a>
<a class="sourceLine" id="cb6-24" title="24"><span class="kw">transmute_dt</span>(DF, <span class="dt">v8 =</span> V3 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-25" title="25"></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">### Remove one column</span></a>
<a class="sourceLine" id="cb6-27" title="27">DT[, v5 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a>
<a class="sourceLine" id="cb6-28" title="28"><span class="kw">set_mutate</span>(DF, <span class="dt">v5 =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb6-29" title="29"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb6-30" title="30"></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="co">### Remove several columns</span></a>
<a class="sourceLine" id="cb6-32" title="32">DT[, <span class="kw">c</span>(<span class="st">&quot;v6&quot;</span>, <span class="st">&quot;v7&quot;</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a>
<a class="sourceLine" id="cb6-33" title="33"><span class="kw">set_mutate</span>(DF, <span class="dt">v6 =</span> <span class="ot">NULL</span>,<span class="dt">v7 =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb6-34" title="34"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb6-35" title="35"></a>
<a class="sourceLine" id="cb6-36" title="36"><span class="co">### Remove columns using a vector of colnames</span></a>
<a class="sourceLine" id="cb6-37" title="37">cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;V3&quot;</span>)</a>
<a class="sourceLine" id="cb6-38" title="38">DT[, (cols) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>] <span class="co"># ! not DT[, cols := NULL]</span></a>
<a class="sourceLine" id="cb6-39" title="39">DF &lt;-<span class="st"> </span><span class="kw">select_dt</span>(DF, <span class="dt">cols =</span> cols,<span class="dt">negate =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-40" title="40"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb6-41" title="41"></a>
<a class="sourceLine" id="cb6-42" title="42"><span class="co">### Replace values for rows matching a condition</span></a>
<a class="sourceLine" id="cb6-43" title="43">DT[V2 <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>, V2 <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]</a>
<a class="sourceLine" id="cb6-44" title="44">DT</a>
<a class="sourceLine" id="cb6-45" title="45">DF =<span class="st"> </span><span class="kw">mutate_when</span>(DF,V2 <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>, <span class="dt">V2 =</span> 0L)</a>
<a class="sourceLine" id="cb6-46" title="46">DF</a>
<a class="sourceLine" id="cb6-47" title="47"><span class="kw">fsetequal</span>(DT,DF)</a></code></pre></div>
</div>
<div id="group-computation-by" class="section level2">
<h2>group computation (by)</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co">### By group</span></a>
<a class="sourceLine" id="cb7-2" title="2">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="kw">summarise_dt</span>(<span class="dt">sumV2 =</span> <span class="kw">sum</span>(V2))</a>
<a class="sourceLine" id="cb7-6" title="6">  )</a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">### By several groups</span></a>
<a class="sourceLine" id="cb7-9" title="9">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="dt">by =</span> .(V4,V1),</a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="kw">summarise_dt</span>(<span class="dt">sumV2 =</span> <span class="kw">sum</span>(V2))</a>
<a class="sourceLine" id="cb7-13" title="13">  )</a>
<a class="sourceLine" id="cb7-14" title="14"></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">### Calling function in by</span></a>
<a class="sourceLine" id="cb7-16" title="16">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb7-18" title="18">    <span class="dt">by =</span> <span class="kw">tolower</span>(V4),</a>
<a class="sourceLine" id="cb7-19" title="19">    <span class="kw">summarise_dt</span>(<span class="dt">sumV1 =</span> <span class="kw">sum</span>(V1))</a>
<a class="sourceLine" id="cb7-20" title="20">  )</a>
<a class="sourceLine" id="cb7-21" title="21"></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">### Assigning column name in by</span></a>
<a class="sourceLine" id="cb7-23" title="23">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb7-25" title="25">    <span class="dt">by =</span> .(<span class="dt">abc =</span> <span class="kw">tolower</span>(V4)),</a>
<a class="sourceLine" id="cb7-26" title="26">    <span class="kw">summarise_dt</span>(<span class="dt">sumV1 =</span> <span class="kw">sum</span>(V1))</a>
<a class="sourceLine" id="cb7-27" title="27">  )</a>
<a class="sourceLine" id="cb7-28" title="28"></a>
<a class="sourceLine" id="cb7-29" title="29"><span class="co">### Using a condition in by</span></a>
<a class="sourceLine" id="cb7-30" title="30">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb7-32" title="32">    <span class="dt">by =</span> V4 <span class="op">==</span><span class="st"> &quot;A&quot;</span>,</a>
<a class="sourceLine" id="cb7-33" title="33">    <span class="kw">summarise_dt</span>(<span class="kw">sum</span>(V1))</a>
<a class="sourceLine" id="cb7-34" title="34">  )</a>
<a class="sourceLine" id="cb7-35" title="35"></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="co">### By on a subset of rows</span></a>
<a class="sourceLine" id="cb7-37" title="37">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-38" title="38"><span class="st">  </span><span class="kw">slice_dt</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-39" title="39"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb7-40" title="40">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb7-41" title="41">    <span class="kw">summarise_dt</span>(<span class="dt">sumV1 =</span> <span class="kw">sum</span>(V1))</a>
<a class="sourceLine" id="cb7-42" title="42">  )</a>
<a class="sourceLine" id="cb7-43" title="43"></a>
<a class="sourceLine" id="cb7-44" title="44"><span class="co">### Count number of observations for each group</span></a>
<a class="sourceLine" id="cb7-45" title="45"><span class="kw">count_dt</span>(DF, V4)</a>
<a class="sourceLine" id="cb7-46" title="46"></a>
<a class="sourceLine" id="cb7-47" title="47"><span class="co">### Add a column with number of observations for each group</span></a>
<a class="sourceLine" id="cb7-48" title="48"><span class="kw">add_count_dt</span>(DF, V1)</a>
<a class="sourceLine" id="cb7-49" title="49"></a>
<a class="sourceLine" id="cb7-50" title="50"><span class="co">### Retrieve the first/last/nth observation for each group</span></a>
<a class="sourceLine" id="cb7-51" title="51">DF <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_dt</span>(<span class="dt">by =</span> V4,<span class="kw">nth</span>(V2,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-52" title="52">DF <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_dt</span>(<span class="dt">by =</span> V4,<span class="kw">nth</span>(V2,<span class="op">-</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-53" title="53">DF <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_dt</span>(<span class="dt">by =</span> V4,<span class="kw">nth</span>(V2,<span class="dv">2</span>))</a></code></pre></div>
</div>
</div>
<div id="going-further" class="section level1">
<h1>Going further</h1>
<div id="advanced-columns-manipulation" class="section level2">
<h2>Advanced columns manipulation</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">### Summarise all the columns</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">summarise_vars</span>(DT,<span class="dt">.func =</span> max)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">### Summarise several columns</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw">summarise_vars</span>(DT,<span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V2&quot;</span>),mean)</a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">### Summarise several columns by group</span></a>
<a class="sourceLine" id="cb8-8" title="8">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb8-10" title="10">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="kw">summarise_vars</span>(<span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V2&quot;</span>),mean)</a>
<a class="sourceLine" id="cb8-12" title="12">  )</a>
<a class="sourceLine" id="cb8-13" title="13"></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co">## using patterns (regex)</span></a>
<a class="sourceLine" id="cb8-15" title="15">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb8-17" title="17">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb8-18" title="18">    <span class="kw">summarise_vars</span>(<span class="st">&quot;V1|V2&quot;</span>,mean)</a>
<a class="sourceLine" id="cb8-19" title="19">  )</a>
<a class="sourceLine" id="cb8-20" title="20"></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="co">## Summarise with more than one function by group</span></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="co"># when you can&#39;t find a way, you can always use `in_dt` to use data.table</span></a>
<a class="sourceLine" id="cb8-23" title="23">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="st">  </span><span class="kw">in_dt</span>(, <span class="dt">by =</span> V4, </a>
<a class="sourceLine" id="cb8-25" title="25">     <span class="kw">c</span>(<span class="kw">lapply</span>(.SD, sum),</a>
<a class="sourceLine" id="cb8-26" title="26">       <span class="kw">lapply</span>(.SD, mean)))</a>
<a class="sourceLine" id="cb8-27" title="27"></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="co">### Summarise using a condition</span></a>
<a class="sourceLine" id="cb8-29" title="29"><span class="kw">summarise_vars</span>(DF, is.numeric, mean)</a>
<a class="sourceLine" id="cb8-30" title="30"></a>
<a class="sourceLine" id="cb8-31" title="31"><span class="co">### Modify all the columns</span></a>
<a class="sourceLine" id="cb8-32" title="32"><span class="kw">mutate_vars</span>(DF, <span class="dt">.func =</span> rev)</a>
<a class="sourceLine" id="cb8-33" title="33"></a>
<a class="sourceLine" id="cb8-34" title="34"><span class="co">### Modify several columns (dropping the others)</span></a>
<a class="sourceLine" id="cb8-35" title="35">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-36" title="36"><span class="st">  </span><span class="kw">select_dt</span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V2&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-37" title="37"><span class="st">  </span><span class="kw">mutate_vars</span>(<span class="dt">.func =</span> sqrt)</a>
<a class="sourceLine" id="cb8-38" title="38">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-39" title="39"><span class="st">  </span><span class="kw">select_dt</span>(<span class="op">-</span>V4) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-40" title="40"><span class="st">  </span><span class="kw">mutate_vars</span>(<span class="dt">.func =</span> exp)</a>
<a class="sourceLine" id="cb8-41" title="41"></a>
<a class="sourceLine" id="cb8-42" title="42"><span class="co">### Modify several columns (keeping the others)</span></a>
<a class="sourceLine" id="cb8-43" title="43">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-44" title="44"><span class="st">  </span><span class="kw">mutate_vars</span>(<span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V2&quot;</span>), sqrt)</a>
<a class="sourceLine" id="cb8-45" title="45">cols &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">names</span>(DT), <span class="st">&quot;V4&quot;</span>)</a>
<a class="sourceLine" id="cb8-46" title="46">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-47" title="47"><span class="st">  </span><span class="kw">mutate_vars</span>(cols, exp)</a>
<a class="sourceLine" id="cb8-48" title="48"></a>
<a class="sourceLine" id="cb8-49" title="49"><span class="co">### Modify columns using a condition (dropping the others)</span></a>
<a class="sourceLine" id="cb8-50" title="50"><span class="kw">select_dt</span>(DT,is.numeric)</a>
<a class="sourceLine" id="cb8-51" title="51"></a>
<a class="sourceLine" id="cb8-52" title="52"><span class="co">### Modify columns using a condition (keeping the others)</span></a>
<a class="sourceLine" id="cb8-53" title="53"><span class="kw">mutate_vars</span>(DT,is.numeric,as.integer)</a>
<a class="sourceLine" id="cb8-54" title="54"></a>
<a class="sourceLine" id="cb8-55" title="55"><span class="co">### Use a complex expression</span></a>
<a class="sourceLine" id="cb8-56" title="56">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-57" title="57"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb8-58" title="58">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb8-59" title="59">    <span class="kw">slice_dt</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-60" title="60"><span class="st">      </span><span class="kw">transmute_dt</span>(<span class="dt">V1 =</span> V1,</a>
<a class="sourceLine" id="cb8-61" title="61">            <span class="dt">V2 =</span> <span class="st">&quot;X&quot;</span>)</a>
<a class="sourceLine" id="cb8-62" title="62">  )</a>
<a class="sourceLine" id="cb8-63" title="63"></a>
<a class="sourceLine" id="cb8-64" title="64"><span class="co">### Use multiple expressions (with DT[,{j}])</span></a>
<a class="sourceLine" id="cb8-65" title="65">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-66" title="66"><span class="st">  </span><span class="kw">in_dt</span>(,{</a>
<a class="sourceLine" id="cb8-67" title="67">      <span class="kw">print</span>(V1) <span class="co">#  comments here!</span></a>
<a class="sourceLine" id="cb8-68" title="68">      <span class="kw">print</span>(<span class="kw">summary</span>(V1))</a>
<a class="sourceLine" id="cb8-69" title="69">      x &lt;-<span class="st"> </span>V1 <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(V2)</a>
<a class="sourceLine" id="cb8-70" title="70">     .(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span>.N, <span class="dt">B =</span> x) <span class="co"># last list returned as a data.table</span></a>
<a class="sourceLine" id="cb8-71" title="71">     }</a>
<a class="sourceLine" id="cb8-72" title="72">  )</a></code></pre></div>
</div>
<div id="indexing-and-keys" class="section level2">
<h2>Indexing and Keys</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co">### Set the key</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">group_by_dt</span>(DF,V4,<span class="dt">inplace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-3" title="3">data.table<span class="op">::</span><span class="kw">setkey</span>(DT,V4)</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">### Select the matching rows</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw">filter_dt</span>(DF, V4 <span class="op">==</span><span class="st"> &quot;A&quot;</span>)</a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">filter_dt</span>(DF, V4 <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>))</a>
<a class="sourceLine" id="cb9-8" title="8"></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">### Select the first matching row</span></a>
<a class="sourceLine" id="cb9-10" title="10">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="st">  </span><span class="kw">filter_dt</span>(V4 <span class="op">==</span><span class="st"> &quot;B&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="st">  </span><span class="kw">slice_dt</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-13" title="13"></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">### Select the last matching row</span></a>
<a class="sourceLine" id="cb9-15" title="15">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="st">  </span><span class="kw">filter_dt</span>(V4 <span class="op">==</span><span class="st"> &quot;A&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="st">  </span><span class="kw">slice_dt</span>(.N)</a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">### Nomatch argument</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="kw">filter_dt</span>(DF, V4 <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>))</a>
<a class="sourceLine" id="cb9-21" title="21"></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">### Apply a function on the matching rows</span></a>
<a class="sourceLine" id="cb9-23" title="23">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-24" title="24"><span class="st">  </span><span class="kw">filter_dt</span>(V4 <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="st">  </span><span class="kw">summarise_dt</span>(<span class="kw">sum</span>(V1))</a>
<a class="sourceLine" id="cb9-26" title="26"></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co">### Modify values for matching rows</span></a>
<a class="sourceLine" id="cb9-28" title="28">DT[<span class="st">&quot;A&quot;</span>, V1 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">0</span>, on =<span class="st"> &quot;V4&quot;</span>]</a>
<a class="sourceLine" id="cb9-29" title="29">DT</a>
<a class="sourceLine" id="cb9-30" title="30">DF &lt;-<span class="st"> </span>DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="st">  </span><span class="kw">mutate_when</span>(V4 <span class="op">==</span><span class="st"> &quot;A&quot;</span>,<span class="dt">V1 =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb9-32" title="32">DF</a>
<a class="sourceLine" id="cb9-33" title="33"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb9-34" title="34"></a>
<a class="sourceLine" id="cb9-35" title="35"><span class="co">### Use keys in by</span></a>
<a class="sourceLine" id="cb9-36" title="36">DF <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="st">  </span><span class="kw">filter_dt</span>(V4 <span class="op">!=</span><span class="st"> &quot;B&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-38" title="38"><span class="st">  </span><span class="kw">group_by_dt</span>(V4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-39" title="39"><span class="st">  </span><span class="kw">group_exe_dt</span>(</a>
<a class="sourceLine" id="cb9-40" title="40">    <span class="kw">summarise_dt</span>(<span class="kw">sum</span>(V1))</a>
<a class="sourceLine" id="cb9-41" title="41">  )</a>
<a class="sourceLine" id="cb9-42" title="42"></a>
<a class="sourceLine" id="cb9-43" title="43"><span class="co">### Set keys for multiple columns</span></a>
<a class="sourceLine" id="cb9-44" title="44"><span class="kw">group_by_dt</span>(DT,V4,V1,<span class="dt">inplace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-45" title="45">DF &lt;-<span class="st"> </span><span class="kw">arrange_dt</span>(DF, V4, V1) </a>
<a class="sourceLine" id="cb9-46" title="46"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb9-47" title="47"></a>
<a class="sourceLine" id="cb9-48" title="48"><span class="co">### Subset using multiple keys/indices</span></a>
<a class="sourceLine" id="cb9-49" title="49"><span class="kw">filter_dt</span>(DF, V1 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, V4 <span class="op">==</span><span class="st"> &quot;C&quot;</span>)</a>
<a class="sourceLine" id="cb9-50" title="50"><span class="kw">filter_dt</span>(DF, V1 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, V4 <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>))</a>
<a class="sourceLine" id="cb9-51" title="51"></a>
<a class="sourceLine" id="cb9-52" title="52"><span class="co">### Remove keys</span></a>
<a class="sourceLine" id="cb9-53" title="53"><span class="kw">tables</span>()</a>
<a class="sourceLine" id="cb9-54" title="54">data.table<span class="op">::</span><span class="kw">setkey</span>(DT, <span class="ot">NULL</span>)</a></code></pre></div>
</div>
<div id="set-modifications" class="section level2">
<h2>set*() modifications</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co">### Replace values</span></a>
<a class="sourceLine" id="cb10-2" title="2">data.table<span class="op">::</span><span class="kw">set</span>(DT, <span class="dt">i =</span> 1L, <span class="dt">j =</span> 2L, <span class="dt">value =</span> 3L)</a>
<a class="sourceLine" id="cb10-3" title="3">DF[<span class="dv">1</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span>3L</a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">### Reorder rows</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">set_dt</span>(DT,<span class="dt">order_by =</span><span class="kw">c</span>(<span class="st">&quot;V4&quot;</span>, <span class="st">&quot;V1&quot;</span>), <span class="dt">order_dirc =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span>) )</a>
<a class="sourceLine" id="cb10-7" title="7"><span class="kw">set_arrange</span>(DF,V4,<span class="op">-</span>V1)</a>
<a class="sourceLine" id="cb10-8" title="8"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">### Modify colnames</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">set_dt</span>(DT,<span class="dt">old_name =</span> <span class="st">&quot;V2&quot;</span>,<span class="dt">new_name =</span> <span class="st">&quot;v2&quot;</span>)</a>
<a class="sourceLine" id="cb10-12" title="12"><span class="kw">set_rename</span>(DF,<span class="dt">v2 =</span> V2)</a>
<a class="sourceLine" id="cb10-13" title="13"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co"># change back</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="kw">set_dt</span>(DT,<span class="dt">new_name =</span> <span class="kw">toupper</span>(<span class="kw">names</span>(DT)))</a>
<a class="sourceLine" id="cb10-16" title="16"><span class="kw">set_dt</span>(DF,<span class="dt">new_name =</span> <span class="kw">toupper</span>(<span class="kw">names</span>(DF)))</a>
<a class="sourceLine" id="cb10-17" title="17"></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">### Reorder columns</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw">set_dt</span>(DT,<span class="dt">col_order =</span> <span class="kw">c</span>(<span class="st">&quot;V4&quot;</span>, <span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V2&quot;</span>))</a>
<a class="sourceLine" id="cb10-20" title="20"><span class="kw">set_relocate</span>(DF,<span class="kw">c</span>(<span class="st">&quot;V4&quot;</span>, <span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V2&quot;</span>))</a>
<a class="sourceLine" id="cb10-21" title="21"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb10-22" title="22"></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">### Convert data</span></a>
<a class="sourceLine" id="cb10-24" title="24">?as_dt <span class="co"># data.frame to data.table</span></a>
<a class="sourceLine" id="cb10-25" title="25">?set_dt <span class="co"># data.frame to data.table by reference</span></a>
<a class="sourceLine" id="cb10-26" title="26"></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="co"># </span></a></code></pre></div>
</div>
<div id="advanced-use-of-by" class="section level2">
<h2>Advanced use of by</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">### Select first/last/… row by group</span></a>
<a class="sourceLine" id="cb11-2" title="2">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="kw">head</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-6" title="6">  )</a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb11-10" title="10">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb11-11" title="11">    <span class="kw">tail</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-12" title="12">  )</a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb11-16" title="16">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb11-17" title="17">    <span class="kw">slice_dt</span>(<span class="dv">1</span>,.N)</a>
<a class="sourceLine" id="cb11-18" title="18">  )</a>
<a class="sourceLine" id="cb11-19" title="19"></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="co">### Select rows using a nested query</span></a>
<a class="sourceLine" id="cb11-21" title="21">DF <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="st">  </span><span class="kw">group_dt</span>(</a>
<a class="sourceLine" id="cb11-23" title="23">    <span class="dt">by =</span> V4,</a>
<a class="sourceLine" id="cb11-24" title="24">    <span class="kw">arrange_dt</span>(V2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="st">      </span><span class="kw">slice_dt</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-26" title="26">  )</a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="co">### Add a group counter column</span></a>
<a class="sourceLine" id="cb11-29" title="29">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-30" title="30"><span class="st">  </span><span class="kw">mutate_dt</span>(<span class="dt">Grp =</span> .GRP,<span class="dt">by =</span> .(V4, V1))</a>
<a class="sourceLine" id="cb11-31" title="31"></a>
<a class="sourceLine" id="cb11-32" title="32"><span class="co">### Get row number of first (and last) observation by group</span></a>
<a class="sourceLine" id="cb11-33" title="33">DT <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute_dt</span>(<span class="dt">I =</span> .I,<span class="dt">by =</span> V4)</a>
<a class="sourceLine" id="cb11-34" title="34">DT <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute_dt</span>(<span class="dt">I =</span> .I[<span class="dv">1</span>],<span class="dt">by =</span> V4)</a>
<a class="sourceLine" id="cb11-35" title="35">DT <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transmute_dt</span>(<span class="dt">I =</span> .I[<span class="kw">c</span>(<span class="dv">1</span>,.N)],<span class="dt">by =</span> V4)</a>
<a class="sourceLine" id="cb11-36" title="36"></a>
<a class="sourceLine" id="cb11-37" title="37"><span class="co">### Handle list-columns by group</span></a>
<a class="sourceLine" id="cb11-38" title="38"></a>
<a class="sourceLine" id="cb11-39" title="39">DT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-40" title="40"><span class="st">  </span><span class="kw">select_dt</span>(V1,V4) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-41" title="41"><span class="st">  </span><span class="kw">chop_dt</span>(V1) <span class="co"># return V1 as a list</span></a>
<a class="sourceLine" id="cb11-42" title="42">DT <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nest_dt</span>(V4) <span class="co"># subsets of the data</span></a>
<a class="sourceLine" id="cb11-43" title="43"></a>
<a class="sourceLine" id="cb11-44" title="44"><span class="co">### Grouping sets (multiple by at once)</span></a>
<a class="sourceLine" id="cb11-45" title="45"><span class="co"># use data.table directly, tidyfst does not provide new methods for it yet</span></a>
<a class="sourceLine" id="cb11-46" title="46">data.table<span class="op">::</span><span class="kw">rollup</span>(DT,</a>
<a class="sourceLine" id="cb11-47" title="47">       .(<span class="dt">SumV2 =</span> <span class="kw">sum</span>(V2)),</a>
<a class="sourceLine" id="cb11-48" title="48">       <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V4&quot;</span>))</a>
<a class="sourceLine" id="cb11-49" title="49"></a>
<a class="sourceLine" id="cb11-50" title="50">data.table<span class="op">::</span><span class="kw">rollup</span>(DT,</a>
<a class="sourceLine" id="cb11-51" title="51">       .(<span class="dt">SumV2 =</span> <span class="kw">sum</span>(V2), .N),</a>
<a class="sourceLine" id="cb11-52" title="52">       <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V4&quot;</span>),</a>
<a class="sourceLine" id="cb11-53" title="53">       <span class="dt">id =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-54" title="54"></a>
<a class="sourceLine" id="cb11-55" title="55">data.table<span class="op">::</span><span class="kw">cube</span>(DT,</a>
<a class="sourceLine" id="cb11-56" title="56">     .(<span class="dt">SumV2 =</span> <span class="kw">sum</span>(V2), .N),</a>
<a class="sourceLine" id="cb11-57" title="57">     <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V4&quot;</span>),</a>
<a class="sourceLine" id="cb11-58" title="58">     <span class="dt">id =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-59" title="59"></a>
<a class="sourceLine" id="cb11-60" title="60">data.table<span class="op">::</span><span class="kw">groupingsets</span>(DT,</a>
<a class="sourceLine" id="cb11-61" title="61">             .(<span class="dt">SumV2 =</span> <span class="kw">sum</span>(V2), .N),</a>
<a class="sourceLine" id="cb11-62" title="62">             <span class="dt">by   =</span> <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V4&quot;</span>),</a>
<a class="sourceLine" id="cb11-63" title="63">             <span class="dt">sets =</span> <span class="kw">list</span>(<span class="st">&quot;V1&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V4&quot;</span>)),</a>
<a class="sourceLine" id="cb11-64" title="64">             <span class="dt">id   =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
</div>
<div id="miscellaneous" class="section level1">
<h1>Miscellaneous</h1>
<div id="read-write-data" class="section level2">
<h2>Read / Write data</h2>
<p>tidyfst exports <code>data.table::fread</code> and <code>data.table::fwrite</code> directly.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co">### Write data to a csv file</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">fwrite</span>(DT, <span class="st">&quot;DT.csv&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">### Write data to a tab-delimited file</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="kw">fwrite</span>(DT, <span class="st">&quot;DT.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">### Write list-column data to a csv file</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="kw">fwrite</span>(<span class="kw">setDT</span>(<span class="kw">list</span>(<span class="dv">0</span>, <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>))), <span class="st">&quot;DT2.csv&quot;</span>)</a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">### Read a csv / tab-delimited file</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="kw">fread</span>(<span class="st">&quot;DT.csv&quot;</span>)</a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co"># fread(&quot;DT.csv&quot;, verbose = TRUE) # full details</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="kw">fread</span>(<span class="st">&quot;DT.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb12-14" title="14"></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">### Read a csv file selecting / droping columns</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="kw">fread</span>(<span class="st">&quot;DT.csv&quot;</span>, <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;V4&quot;</span>))</a>
<a class="sourceLine" id="cb12-17" title="17"><span class="kw">fread</span>(<span class="st">&quot;DT.csv&quot;</span>, <span class="dt">drop =</span> <span class="st">&quot;V4&quot;</span>)</a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co"># NA</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">### Read and rbind several files</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="kw">rbindlist</span>(<span class="kw">lapply</span>(<span class="kw">c</span>(<span class="st">&quot;DT.csv&quot;</span>, <span class="st">&quot;DT.csv&quot;</span>), fread))</a>
<a class="sourceLine" id="cb12-21" title="21"><span class="co"># c(&quot;DT.csv&quot;, &quot;DT.csv&quot;) %&gt;% lapply(fread) %&gt;% rbindlist</span></a></code></pre></div>
</div>
<div id="reshape-data" class="section level2">
<h2>Reshape data</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co">### Melt data (from wide to long)</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">fsetequal</span>(DT,DF)</a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4">mDT =<span class="st"> </span>DT <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">longer_dt</span>(V4)</a>
<a class="sourceLine" id="cb13-5" title="5">mDF =<span class="st"> </span>DF <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">longer_dt</span>(<span class="op">-</span><span class="st">&quot;V1|V2&quot;</span>)</a>
<a class="sourceLine" id="cb13-6" title="6"></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="kw">fsetequal</span>(mDT,mDF)</a>
<a class="sourceLine" id="cb13-8" title="8">mDT</a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">### Cast data (from long to wide)</span></a>
<a class="sourceLine" id="cb13-11" title="11">mDT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="st">  </span><span class="kw">wider_dt</span>(V4,<span class="dt">name =</span> <span class="st">&quot;name&quot;</span>,<span class="dt">value =</span> <span class="st">&quot;value&quot;</span>)</a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co"># below is a special case and could only be done in tidyfst</span></a>
<a class="sourceLine" id="cb13-14" title="14">mDT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="st">  </span><span class="kw">wider_dt</span>(V4,<span class="dt">name =</span> <span class="st">&quot;name&quot;</span>,<span class="dt">value =</span> <span class="st">&quot;value&quot;</span>,<span class="dt">fun =</span> list)</a>
<a class="sourceLine" id="cb13-16" title="16"></a>
<a class="sourceLine" id="cb13-17" title="17">mDT <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="st">  </span><span class="kw">wider_dt</span>(V4,<span class="dt">name =</span> <span class="st">&quot;name&quot;</span>,<span class="dt">value =</span> <span class="st">&quot;value&quot;</span>,<span class="dt">fun =</span> sum)</a>
<a class="sourceLine" id="cb13-19" title="19"></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="co">### Split</span></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="kw">split</span>(DT, <span class="dt">by =</span> <span class="st">&quot;V4&quot;</span>)</a></code></pre></div>
</div>
<div id="other" class="section level2">
<h2>Other</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co">### Lead/Lag</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">lag_dt</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dt">n =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">lag_dt</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dt">n =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="kw">lead_dt</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dt">n =</span> <span class="dv">1</span>)</a></code></pre></div>
</div>
</div>
<div id="joinbind-data-sets" class="section level1">
<h1>Join/Bind data sets</h1>
<div id="join" class="section level2">
<h2>Join</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">x &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Id  =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;C&quot;</span>),</a>
<a class="sourceLine" id="cb15-2" title="2">                <span class="dt">X1  =</span> <span class="kw">c</span>(1L, 3L, 5L, 7L),</a>
<a class="sourceLine" id="cb15-3" title="3">                <span class="dt">XY  =</span> <span class="kw">c</span>(<span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x4&quot;</span>, <span class="st">&quot;x6&quot;</span>, <span class="st">&quot;x8&quot;</span>),</a>
<a class="sourceLine" id="cb15-4" title="4">                <span class="dt">key =</span> <span class="st">&quot;Id&quot;</span>)</a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6">y &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Id  =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;D&quot;</span>),</a>
<a class="sourceLine" id="cb15-7" title="7">                <span class="dt">Y1  =</span> <span class="kw">c</span>(1L, 3L, 5L, 7L),</a>
<a class="sourceLine" id="cb15-8" title="8">                <span class="dt">XY  =</span> <span class="kw">c</span>(<span class="st">&quot;y1&quot;</span>, <span class="st">&quot;y3&quot;</span>, <span class="st">&quot;y5&quot;</span>, <span class="st">&quot;y7&quot;</span>),</a>
<a class="sourceLine" id="cb15-9" title="9">                <span class="dt">key =</span> <span class="st">&quot;Id&quot;</span>)</a>
<a class="sourceLine" id="cb15-10" title="10"></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">### left join</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="kw">left_join_dt</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;Id&quot;</span>)</a>
<a class="sourceLine" id="cb15-13" title="13"></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co">### right join</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="kw">right_join_dt</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;Id&quot;</span>)</a>
<a class="sourceLine" id="cb15-16" title="16"></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="co">### inner join</span></a>
<a class="sourceLine" id="cb15-18" title="18"><span class="kw">inner_join_dt</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;Id&quot;</span>)</a>
<a class="sourceLine" id="cb15-19" title="19"></a>
<a class="sourceLine" id="cb15-20" title="20"><span class="co">### full join</span></a>
<a class="sourceLine" id="cb15-21" title="21"><span class="kw">full_join_dt</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;Id&quot;</span>)</a>
<a class="sourceLine" id="cb15-22" title="22"></a>
<a class="sourceLine" id="cb15-23" title="23"><span class="co">### semi join</span></a>
<a class="sourceLine" id="cb15-24" title="24"><span class="kw">semi_join_dt</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;Id&quot;</span>)</a>
<a class="sourceLine" id="cb15-25" title="25"></a>
<a class="sourceLine" id="cb15-26" title="26"><span class="co">### anti join</span></a>
<a class="sourceLine" id="cb15-27" title="27"><span class="kw">anti_join_dt</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;Id&quot;</span>)</a></code></pre></div>
</div>
<div id="bind" class="section level2">
<h2>Bind</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">x &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb16-2" title="2">y &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb16-3" title="3">z &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dv">7</span><span class="op">:</span><span class="dv">9</span>, 0L)</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">### Bind rows</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="kw">rbind</span>(x, y)</a>
<a class="sourceLine" id="cb16-6" title="6"><span class="kw">rbind</span>(x, z, <span class="dt">fill =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co">### Bind rows using a list</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="kw">rbindlist</span>(<span class="kw">list</span>(x, y), <span class="dt">idcol =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-10" title="10"></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="co">### Bind columns</span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="kw">cbind</span>(x, y)</a></code></pre></div>
</div>
<div id="set-operations" class="section level2">
<h2>Set operations</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">x &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb17-2" title="2">y &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co">### Intersection</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="kw">fintersect</span>(x, y)</a>
<a class="sourceLine" id="cb17-5" title="5"><span class="kw">fintersect</span>(x, y, <span class="dt">all =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">### Difference</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="kw">fsetdiff</span>(x, y)</a>
<a class="sourceLine" id="cb17-9" title="9"><span class="kw">fsetdiff</span>(x, y, <span class="dt">all =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-10" title="10"></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co">### Union</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="kw">funion</span>(x, y)</a>
<a class="sourceLine" id="cb17-13" title="13"><span class="kw">funion</span>(x, y, <span class="dt">all =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-14" title="14"></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="co">### Equality</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="kw">fsetequal</span>(x, x[<span class="kw">order</span>(<span class="op">-</span>V1),])</a>
<a class="sourceLine" id="cb17-17" title="17"><span class="kw">all.equal</span>(x, x) <span class="co"># S3 method</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="kw">setequal</span>(x, x[<span class="kw">order</span>(<span class="op">-</span>V1),])</a></code></pre></div>
</div>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>To break all these codes through, tidyfst has improved bit by bit. If you are using tidyfst frequently, you’ll find that while it enjoys a tidy syntax, it is more like you are using data.table in another style. Compared with many other packages with similar goals, tidyfst sticks to many principles of data.table (and is more like data.table in many ways). However, the ultimate goal is still clear: providing users with state-of-the-art data manipulation tools with least pain. Therefore, keep it simple and make it fast. Enjoy tidyfst~</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
